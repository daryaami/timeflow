import{e as v,g as M,f as H,h as w,r as N,o as l,i as L,w as R,c,b as t,t as f,j as k,n as C,k as E,l as W,m as V,F as T,p as x,u as O,q as B,s as U,v as F,x as I,_ as j,y as P,z,a as S,A as q,B as X,C as D,D as A}from"./index-BOHnSLzY.js";const G={key:0,class:"event-card__short-wrapper"},Y={class:"event-card__name"},J={class:"event-card__time"},K={class:"event-card__name-wrapper"},Q={key:1,class:"event-card__time"},Z={__name:"EventCard",props:["event","gridHeight"],setup(o){const a=o,n=v(M(a.event.end.dateTime)-M(a.event.start.dateTime)),s=v(H(a.event.start.dateTime)),d=v(),u=w(()=>M(a.event.start.dateTime)*100/24),p=w(()=>Math.max(n.value,.25)*100/24),h=w(()=>`${s.value} - ${H(a.event.end.dateTime)}`),g=w(()=>new Date(a.event.end.dateTime)<new Date),m=w(()=>a.gridHeight?[10,a.gridHeight/96]:[0,0]),r=w(()=>a.event.overlapLevel?a.event.overlapLevel+1:1);return(e,i)=>{const _=N("vue-draggable-resizable");return o.gridHeight?(l(),L(_,{key:0,class:C(["event-card",{"no-padding":n.value<=.25,"no-right-padding":n.value<=.5,past:g.value,overlap:o.event.overlapLevel}]),axis:"y",grid:m.value,handles:["tm","bm"],active:!0,style:E({top:`${u.value}%`,height:`calc(${p.value}% - 2px)`,backgroundColor:`${o.event.background_color}`,color:`${o.event.foreground_color}`,width:`calc(100% - ${r.value*.75}rem)`}),ref_key:"card",ref:d},{default:R(()=>[n.value<=.5?(l(),c("div",G,[t("span",Y,f(o.event.summary)+", ",1),t("span",J,f(s.value),1)])):k("",!0),t("div",K,[n.value>.5?(l(),c("span",{key:0,class:C(["event-card__name",{"one-string":n.value<=1}])},f(o.event.summary),3)):k("",!0)]),n.value>.5?(l(),c("span",Q,f(h.value),1)):k("",!0)]),_:1},8,["grid","style","class"])):k("",!0)}}},ee=[{time:"01:00",percent:100/24},{time:"02:00",percent:200/24},{time:"03:00",percent:300/24},{time:"04:00",percent:400/24},{time:"05:00",percent:500/24},{time:"06:00",percent:600/24},{time:"07:00",percent:700/24},{time:"08:00",percent:800/24},{time:"09:00",percent:900/24},{time:"10:00",percent:1e3/24},{time:"11:00",percent:1100/24},{time:"12:00",percent:1200/24},{time:"13:00",percent:1300/24},{time:"14:00",percent:1400/24},{time:"15:00",percent:1500/24},{time:"16:00",percent:1600/24},{time:"17:00",percent:1700/24},{time:"18:00",percent:1800/24},{time:"19:00",percent:1900/24},{time:"20:00",percent:2e3/24},{time:"21:00",percent:2100/24},{time:"22:00",percent:2200/24},{time:"23:00",percent:2300/24}],te={class:"planner__line-time"},ne={class:"planner__line-time"},ae={__name:"PlannerGrid",props:["days"],setup(o){const a=v(null),n=v(),s=v(null),d=v(null),u=v({caption:"",styleTop:""}),p=()=>{d.value.style.display="none";const m=document.querySelector(".planner-date.current");if(!m)return;const r=(m.getBoundingClientRect().left-s.value.getBoundingClientRect().left)/s.value.offsetWidth*100,e=m.offsetWidth*.9/s.value.offsetWidth*100;d.value.style.left=`${r}%`,d.value.style.width=`${e}%`,d.value.style.display="block"},h=()=>{const m=new Date;u.value.caption=H(m),u.value.styleTop=`${M(m)*100/24}%`},g=async()=>{h(),await V(),p(),s.value.scrollIntoView({block:"center"});const r=(60-new Date().getSeconds())*1e3;setTimeout(()=>{h(),setInterval(h,6e4)},r)};return W(async()=>{await V(),g(),n.value=a.value.offsetHeight}),(m,r)=>(l(),c("div",{class:"planner__grid",ref_key:"grid",ref:a},[(l(!0),c(T,null,x(o.days,e=>(l(),c("div",{class:"planner__day-column",key:e.date},[(l(!0),c(T,null,x(e.events,(i,_)=>(l(),L(Z,{key:_,event:i,gridHeight:n.value},null,8,["event","gridHeight"]))),128))]))),128)),(l(!0),c(T,null,x(O(ee),(e,i)=>(l(),c("div",{class:"planner__line",key:i,style:E({top:`${e.percent}%`})},[t("div",te,f(e.time),1)],4))),128)),t("div",{class:"planner__line planner__line--now",style:E({top:`${u.value.styleTop}`}),ref_key:"timeLineEl",ref:s},[t("div",ne,f(u.value.caption),1),t("div",{class:"planner__line-today-line",ref_key:"todayLine",ref:d},null,512)],4)],512))}},se={class:"planner-header"},re={class:"planner-header__date"},le={class:"planner-header__buttons"},oe={__name:"PlannerHeader",props:B(["isSidebarOpened","currentMonth"],{modelValue:{},modelModifiers:{}}),emits:B(["prevWeek","nextWeek"],["update:modelValue"]),setup(o,{emit:a}){const n=a,s=U(o,"modelValue");return(d,u)=>(l(),c("header",se,[t("span",re,f(o.currentMonth),1),t("div",le,[t("button",{class:"planner-header__date-button planner-header__date-button--prev icon-button",onClick:u[0]||(u[0]=p=>n("prevWeek"))}),t("button",{class:"planner-header__date-button planner-header__date-button--next icon-button",onClick:u[1]||(u[1]=p=>n("nextWeek"))})]),t("label",{class:C(["sidebar-hide icon-button",{rotated:!s.value}])},[F(t("input",{type:"checkbox",class:"visually-hidden","onUpdate:modelValue":u[2]||(u[2]=p=>s.value=p)},null,512),[[I,s.value]])],2)]))}},ie={},ce={class:"loading-container"},de=t("div",{class:"loading-progress"},null,-1),ue=[de];function ve(o,a){return l(),c("div",ce,ue)}const _e=j(ie,[["render",ve]]),pe={class:"planner-date__weekday"},me={class:"planner-date__day"},he={__name:"PlannerDate",props:["day"],setup(o){return(a,n)=>(l(),c("div",{class:C(["planner-date",{current:o.day.isToday}])},[t("span",pe,f(o.day.weekday),1),t("div",me,[t("span",null,f(o.day.date),1)])],2))}},ye={class:"task"},fe=["for"],ge=["id"],ke={__name:"TaskItem",props:["task"],setup(o){return(a,n)=>(l(),c("div",ye,[t("span",{class:"task__color",style:E({backgroundColor:o.task.color})},null,4),t("label",{class:"task__checkbox-label",for:a.title},[t("input",{class:"visually-hidden",id:a.title,type:"checkbox"},null,8,ge)],8,fe),t("span",null,f(o.task.name),1)]))}},$e={class:"right-sidebar__tabs"},we=t("span",null,"Tasks",-1),be=[we],De={class:"underline"},Te={key:0,class:"tasks"},xe={__name:"RightSidebar",props:["isOpened"],setup(o){const a=v(),n=v();v(null);const s=v(null),d=v(null),u=v(P.value.tasks);return W(()=>{d.value=s.value}),z(d,()=>{a.value.style.transform=`translateX(${d.value.offsetLeft}px)`,n.value.style.transform=`translateX(${d.value.offsetLeft}px)`}),(p,h)=>(l(),c("div",{class:C(["right-sidebar",{hidden:!o.isOpened}])},[t("div",$e,[t("button",{ref_key:"tasksButton",ref:s,class:"right-sidebar__tab",onClick:h[0]||(h[0]=g=>d.value=s.value)},be,512),t("div",De,[t("div",{ref_key:"underlineRight",ref:a,class:"underline__closer underline__closer--right"},null,512),t("div",{ref_key:"underlineLeft",ref:n,class:"underline__closer underline__closer--left"},null,512)])]),d.value===s.value?(l(),c("div",Te,[(l(!0),c(T,null,x(u.value,g=>(l(),L(ke,{key:g.id,task:g},null,8,["task"]))),128))])):k("",!0)],2))}},Le={class:"planner-wrapper"},Ce={class:"planner"},Me={key:0,class:"planner__loader-wrapper"},Ee={key:1,class:"planner__grid-wrapper"},Se={class:"planner__days-header"},Ve={__name:"Planner",setup(o){const a=v(!0),n=v([]),s=v(!0),d=r=>{const e=r.sort((i,_)=>new Date(i.start.dateTime)-new Date(_.start.dateTime));for(let i=1;i<e.length;i++){const _=e[i],y=new Date(_.start.dateTime);for(let b=i-1;b>=0;b--){const $=e[b];if(y>new Date($.start.dateTime)&&y<new Date($.end.dateTime)){$.overlapLevel?_.overlapLevel=$.overlapLevel+1:_.overlapLevel=1;break}}}return e},u=(r,e)=>{const i=X(r);n.value=[];for(let _=0;_<7;_++){const y=new Date(i);y.setDate(i.getDate()+_);const b=e.filter($=>D(y,new Date($.start.dateTime))||D(y,new Date($.end.dateTime)));n.value.push({weekday:y.toLocaleDateString("en-EN",{weekday:"short"}),date:y.getDate(),isToday:D(y,new Date),day:y,events:d(b)})}},p=async(r=new Date)=>{try{const e=await q(r);u(r,e)}catch(e){console.error("ошибка",e)}finally{s.value=!1,await V()}},h=async()=>{if(s.value)return;s.value=!0;const r=n.value[0].day,e=new Date(r.setDate(r.getDate()+7));p(e)},g=async()=>{if(s.value)return;s.value=!0;const r=n.value[0].day,e=new Date(r.setDate(r.getDate()-7));p(e)},m=w(()=>{if(n.value.length){const r=n.value[0].day;return`${r.toLocaleString("default",{month:"long"})} ${r.getFullYear()}`}else return""});return W(()=>{p()}),z(A,r=>{r.forEach(e=>{const i=n.value.find(_=>D(_.day,new Date(e.start.dateTime))||D(_.day,new Date(e.end.dateTime)));i&&i.events.push(e)})}),(r,e)=>(l(),c("div",Le,[t("div",Ce,[S(oe,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value=i),currentMonth:m.value,onPrevWeek:g,onNextWeek:h},null,8,["modelValue","currentMonth"]),s.value?(l(),c("div",Me,[S(_e)])):k("",!0),s.value?k("",!0):(l(),c("div",Ee,[t("div",Se,[(l(!0),c(T,null,x(n.value,i=>(l(),L(he,{key:i.date,day:i},null,8,["day"]))),128))]),S(ae,{days:n.value},null,8,["days"])]))]),O(P)?(l(),L(xe,{key:0,isOpened:a.value},null,8,["isOpened"])):k("",!0)]))}};export{Ve as default};
