import{e as k,f,g as M,h as R,r as X,o as s,i as C,w as A,c as i,b as e,t as g,j as w,n as L,k as H,l as I,m as W,F as S,p as E,u as O,q as G,s as Y,v as N,x as U,y as Z,z as J,A as K,_ as F,a as P,B as Q,C as z,D as ee}from"./index-B-mrp97K.js";const te={key:0,class:"event-card__short-wrapper"},ne={class:"event-card__name"},ae={class:"event-card__time"},se={class:"event-card__name-wrapper"},re={key:1,class:"event-card__time"},le={__name:"EventCard",props:["card","gridHeight"],setup(a){const n=a,r=k(()=>(new Date(n.card.end)-new Date(n.card.start))/(1e3*60*60)),h=f(M(n.card.event.start.dateTime)),v=k(()=>R(n.card.start)*100/24),d=k(()=>Math.max(r.value,.25)*100/24),p=k(()=>`${h.value} - ${M(n.card.event.end.dateTime)}`),l=k(()=>new Date(n.card.event.end.dateTime)<new Date),c=k(()=>n.gridHeight?[10,n.gridHeight/96]:[0,0]),o=k(()=>n.card.overlapLevel?n.card.overlapLevel+1:1);return(_,T)=>{const x=X("vue-draggable-resizable");return a.gridHeight?(s(),C(x,{key:0,class:L(["event-card",{"no-padding":r.value<=.25,"no-right-padding":r.value<=.5,past:l.value,overlap:a.card.overlapLevel}]),axis:"y",grid:c.value,handles:["tm","bm"],active:!0,style:H({top:`${v.value}%`,height:`calc(${d.value}% - 2px)`,backgroundColor:`${a.card.event.background_color}`,color:`${a.card.event.foreground_color}`,width:`calc(100% - ${o.value*.75}rem)`})},{default:A(()=>[r.value<.75?(s(),i("div",te,[e("span",ne,g(a.card.event.summary)+", ",1),e("span",ae,g(h.value),1)])):w("",!0),e("div",se,[r.value>=.75?(s(),i("span",{key:0,class:L(["event-card__name",{"one-string":r.value<=1}])},g(a.card.event.summary),3)):w("",!0)]),r.value>=.75?(s(),i("span",re,g(p.value),1)):w("",!0)]),_:1},8,["grid","style","class"])):w("",!0)}}},oe=[{time:"01:00",percent:100/24},{time:"02:00",percent:200/24},{time:"03:00",percent:300/24},{time:"04:00",percent:400/24},{time:"05:00",percent:500/24},{time:"06:00",percent:600/24},{time:"07:00",percent:700/24},{time:"08:00",percent:800/24},{time:"09:00",percent:900/24},{time:"10:00",percent:1e3/24},{time:"11:00",percent:1100/24},{time:"12:00",percent:1200/24},{time:"13:00",percent:1300/24},{time:"14:00",percent:1400/24},{time:"15:00",percent:1500/24},{time:"16:00",percent:1600/24},{time:"17:00",percent:1700/24},{time:"18:00",percent:1800/24},{time:"19:00",percent:1900/24},{time:"20:00",percent:2e3/24},{time:"21:00",percent:2100/24},{time:"22:00",percent:2200/24},{time:"23:00",percent:2300/24}],ce={class:"planner-date__weekday"},ie={class:"planner-date__day"},de={__name:"PlannerDate",props:["day"],setup(a){return(n,r)=>(s(),i("div",{class:L(["planner-date",{current:a.day.isToday}])},[e("span",ce,g(a.day.weekday),1),e("div",ie,[e("span",null,g(a.day.date),1)])],2))}},ue={class:"planner__grid-wrapper"},_e={class:"planner__days-header"},ve={class:"planner__line-time"},pe={class:"planner__line-time"},me={__name:"PlannerGrid",props:["events","currentDate","selectedEvent"],emits:["cardClick"],setup(a,{emit:n}){const r=a,h=n,v=y=>{const m=y.sort((t,u)=>new Date(t.start)-new Date(u.start));for(let t=1;t<m.length;t++){const u=m[t],b=new Date(u.start);for(let D=t-1;D>=0;D--){const $=m[D];if(b>new Date($.start)&&b<new Date($.end)){$.overlapLevel?u.overlapLevel=$.overlapLevel+1:u.overlapLevel=1;break}}}return m},d=k(()=>{const y=G(r.currentDate),m=[];for(let t=0;t<7;t++){const u=new Date(y);u.setDate(y.getDate()+t),m.push({weekday:u.toLocaleDateString("en-EN",{weekday:"short"}),date:u.getDate(),isToday:Y(u,new Date),day:u,cards:[]})}return r.events.forEach(t=>{if(!t.start.dateTime)return;const u=new Date(t.start.dateTime),b=new Date(t.end.dateTime);if(u.getDate()===b.getDate()){const D=m.find(V=>V.date===u.getDate());if(!D)return;const $={event:t,start:t.start.dateTime,end:t.end.dateTime};D.cards.push($)}else{const D={event:t,start:t.start.dateTime,end:t.start.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T23:59:00")},$=m.find(B=>B.date===u.getDate());$&&$.cards.push(D);const V={event:t,start:t.end.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T00:00:00"),end:t.end.dateTime},q=m.find(B=>B.date===b.getDate());$&&q.cards.push(V)}}),m.forEach(t=>t.cards=v(t.cards)),m}),p=f(null),l=f(),c=f(null),o=f(null),_=f({caption:"",styleTop:""}),T=()=>{o.value.style.display="none";const y=document.querySelector(".planner-date.current");if(!y)return;const m=(y.getBoundingClientRect().left-c.value.getBoundingClientRect().left)/c.value.offsetWidth*100,t=y.offsetWidth*.9/c.value.offsetWidth*100;o.value.style.left=`${m}%`,o.value.style.width=`${t}%`,o.value.style.display="block"},x=()=>{const y=new Date;_.value.caption=M(y),_.value.styleTop=`${R(y)*100/24}%`},j=async()=>{x(),await W(),T(),c.value.scrollIntoView({block:"center"});const m=(60-new Date().getSeconds())*1e3;setTimeout(()=>{x(),setInterval(x,6e4)},m)};return I(async()=>{await W(),j(),l.value=p.value.offsetHeight}),(y,m)=>(s(),i("div",ue,[e("div",_e,[(s(!0),i(S,null,E(d.value,t=>(s(),C(de,{key:t.date,day:t},null,8,["day"]))),128))]),e("div",{class:"planner__grid",ref_key:"grid",ref:p},[(s(!0),i(S,null,E(d.value,t=>(s(),i("div",{class:"planner__day-column",key:t.date},[(s(!0),i(S,null,E(t.cards,(u,b)=>(s(),C(le,{key:b,card:u,gridHeight:l.value,onClick:D=>h("cardClick",u.event),class:L({selected:a.selectedEvent===u.event})},null,8,["card","gridHeight","onClick","class"]))),128))]))),128)),(s(!0),i(S,null,E(O(oe),(t,u)=>(s(),i("div",{class:"planner__line",key:u,style:H({top:`${t.percent}%`})},[e("div",ve,g(t.time),1)],4))),128)),e("div",{class:"planner__line planner__line--now",style:H({top:`${_.value.styleTop}`}),ref_key:"timeLineEl",ref:c},[e("div",pe,g(_.value.caption),1),e("div",{class:"planner__line-today-line",ref_key:"todayLine",ref:o},null,512)],4)],512)]))}},he={class:"planner-header"},fe={class:"planner-header__date"},ge={__name:"PlannerHeader",props:N(["isSidebarOpened","isLoading"],{modelValue:{},modelModifiers:{}}),emits:N(["prevWeek","nextWeek"],["update:modelValue"]),setup(a,{emit:n}){const r=U(),h=a,v=Z(a,"modelValue"),d=k(()=>{if(r.date){const c=r.date;return`${c.toLocaleString("default",{month:"long"})} ${c.getFullYear()}`}else return""}),p=async()=>{h.isLoading||r.toNextWeek()},l=async()=>{h.isLoading||r.toPrevWeek()};return(c,o)=>(s(),i("header",he,[e("span",fe,g(d.value),1),e("div",{class:"planner-header__buttons"},[e("button",{class:"planner-header__date-button planner-header__date-button--prev icon-button",onClick:l}),e("button",{class:"planner-header__date-button planner-header__date-button--next icon-button",onClick:p})]),e("label",{class:L(["sidebar-hide icon-button",{rotated:!v.value}])},[J(e("input",{type:"checkbox",class:"visually-hidden","onUpdate:modelValue":o[0]||(o[0]=_=>v.value=_)},null,512),[[K,v.value]])],2)]))}},ye={},ke={class:"loading-container"};function $e(a,n){return s(),i("div",ke,n[0]||(n[0]=[e("div",{class:"loading-progress"},null,-1)]))}const we=F(ye,[["render",$e]]),De={},be={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ce(a,n){return s(),i("svg",be,n[0]||(n[0]=[e("path",{d:"M20.7457 3.32854C20.3552 2.93801 19.722 2.93801 19.3315 3.32854L12.0371 10.6229L4.74275 3.32854C4.35223 2.93801 3.71906 2.93801 3.32854 3.32854C2.93801 3.71906 2.93801 4.35223 3.32854 4.74275L10.6229 12.0371L3.32856 19.3314C2.93803 19.722 2.93803 20.3551 3.32856 20.7457C3.71908 21.1362 4.35225 21.1362 4.74277 20.7457L12.0371 13.4513L19.3315 20.7457C19.722 21.1362 20.3552 21.1362 20.7457 20.7457C21.1362 20.3551 21.1362 19.722 20.7457 19.3315L13.4513 12.0371L20.7457 4.74275C21.1362 4.35223 21.1362 3.71906 20.7457 3.32854Z",fill:"currentColor"},null,-1)]))}const Le=F(De,[["render",Ce]]),Te={class:"event-info-sidebar"},xe={class:"event-info-sidebar__buttons-wrapper"},Se={class:"event-info-sidebar__event-title"},Ee={class:"event-characteristics"},Me={class:"event-characteristics__value"},He={class:"event-characteristics__value"},Ve={key:0},Be={class:"event-characteristics__value"},We={__name:"EventInfoSidebar",props:["event"],emits:["close"],setup(a,{emit:n}){const r=a,h=n,v=k(()=>{const p=new Date(r.event.start.dateTime),c=new Date(r.event.end.dateTime)-p,o=Math.floor(c/(1e3*60*60)),_=Math.floor(c%(1e3*60*60)/(1e3*60));return`${o} hr${o>1?"s":""}${_>0?` ${_} min`:""}`}),d=k(()=>{const p=new Date(r.event.start.dateTime),l=new Date(r.event.end.dateTime);return`${p.getDate()}/${p.getMonth()} ${M(p)} - ${M(l)}`});return(p,l)=>(s(),i("div",Te,[e("div",xe,[e("button",{class:"event-info-sidebar__button icon-button",onClick:l[0]||(l[0]=c=>h("close"))},[P(Le)])]),e("span",Se,g(a.event.summary),1),e("ul",Ee,[e("li",null,[l[1]||(l[1]=e("span",{class:"event-characteristics__name"},"Duration",-1)),e("span",Me,g(v.value),1)]),e("li",null,[l[2]||(l[2]=e("span",{class:"event-characteristics__name"},"Dates",-1)),e("span",He,g(d.value),1)]),a.event.calendar?(s(),i("li",Ve,[l[3]||(l[3]=e("span",{class:"event-characteristics__name"},"Calendar",-1)),e("span",Be,g(a.event.calendar),1)])):w("",!0)])]))}},Pe={class:"task"},ze=["for"],Ie=["id"],Ne={__name:"TaskItem",props:["task"],setup(a){return(n,r)=>(s(),i("div",Pe,[e("span",{class:"task__color",style:H({backgroundColor:a.task.color})},null,4),e("label",{class:"task__checkbox-label",for:n.title},[e("input",{class:"visually-hidden",id:n.title,type:"checkbox"},null,8,Ie)],8,ze),e("span",null,g(a.task.name),1)]))}},Re={class:"right-sidebar"},Oe={class:"right-sidebar__tabs"},Ue={class:"underline"},Fe={key:0,class:"tasks"},je={__name:"RightSidebar",setup(a){const n=Q(),r=f(),h=f();f(null);const v=f(null),d=f(null),p=k(()=>n.userData.tasks);return I(()=>{d.value=v.value}),z(d,()=>{r.value.style.transform=`translateX(${d.value.offsetLeft}px)`,h.value.style.transform=`translateX(${d.value.offsetLeft}px)`}),(l,c)=>(s(),i("div",Re,[e("div",Oe,[e("button",{ref_key:"tasksButton",ref:v,class:"right-sidebar__tab",onClick:c[0]||(c[0]=o=>d.value=v.value)},c[1]||(c[1]=[e("span",null,"Tasks",-1)]),512),e("div",Ue,[e("div",{ref_key:"underlineRight",ref:r,class:"underline__closer underline__closer--right"},null,512),e("div",{ref_key:"underlineLeft",ref:h,class:"underline__closer underline__closer--left"},null,512)])]),d.value===v.value?(s(),i("div",Fe,[(s(!0),i(S,null,E(p.value,o=>(s(),C(Ne,{key:o.id,task:o},null,8,["task"]))),128))])):w("",!0)]))}},qe={class:"planner-wrapper"},Xe={class:"planner"},Ae={key:0,class:"planner__loader-wrapper"},Ye={__name:"Planner",setup(a){const n=f(!0),r=f(),h=ee(),v=U(),d=f(!0),p=async o=>{d.value=!0;try{const _=await h.getEvents(o);r.value=_}catch(_){console.error("ошибка",_)}finally{d.value=!1,await W()}};z(v,o=>{p(o.date)}),z(h,()=>{p(v.date)}),I(()=>{p(v.date)});const l=f(null),c=o=>{l.value=o};return(o,_)=>(s(),i("div",qe,[e("div",Xe,[P(ge,{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=T=>n.value=T),isLoading:d.value},null,8,["modelValue","isLoading"]),d.value?(s(),i("div",Ae,[P(we)])):w("",!0),d.value?w("",!0):(s(),C(me,{key:1,events:r.value,"current-date":O(v).date,selectedEvent:l.value,onCardClick:c},null,8,["events","current-date","selectedEvent"]))]),e("div",{class:L(["planner__right-sidebar",{hidden:!n.value}])},[l.value?w("",!0):(s(),C(je,{key:0})),l.value?(s(),C(We,{key:1,event:l.value,onClose:_[1]||(_[1]=T=>l.value=null)},null,8,["event"])):w("",!0)],2)]))}};export{Ye as default};
