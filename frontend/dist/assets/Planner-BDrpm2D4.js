import{e as $,f as m,g as H,h as F,r as G,o as n,i as x,w as Y,c as o,b as e,t as y,j as w,n as M,k as V,l as P,m as Z,p as R,q as z,F as E,s as S,u as I,v as O,x as J,y as K,z as Q,_ as U,a as N,A as j,B as q,C as ee,D as L,E as te}from"./index-DtOdcqZR.js";const ne={key:0,class:"event-card__short-wrapper"},ae={class:"event-card__name"},se={class:"event-card__time"},re={class:"event-card__name-wrapper"},le={key:1,class:"event-card__time"},ce={__name:"EventCard",props:["card","gridHeight"],setup(a){const s=a,r=$(()=>(new Date(s.card.end)-new Date(s.card.start))/(1e3*60*60)),c=m(H(s.card.event.start.dateTime)),u=$(()=>F(s.card.start)*100/24),v=$(()=>Math.max(r.value,.25)*100/24),_=$(()=>`${c.value} - ${H(s.card.event.end.dateTime)}`),h=$(()=>new Date(s.card.event.end.dateTime)<new Date),i=$(()=>s.gridHeight?[10,s.gridHeight/96]:[0,0]),k=$(()=>s.card.overlapLevel?s.card.overlapLevel+1:1);return(l,f)=>{const C=G("vue-draggable-resizable");return a.gridHeight?(n(),x(C,{key:0,class:M(["event-card",{"no-padding":r.value<=.25,"no-right-padding":r.value<=.5,past:h.value,overlap:a.card.overlapLevel}]),axis:"y",grid:i.value,handles:["tm","bm"],active:!0,style:V({top:`${u.value}%`,height:`calc(${v.value}% - 2px)`,backgroundColor:`${a.card.event.background_color}`,color:`${a.card.event.foreground_color}`,width:`calc(100% - ${k.value*.75}rem)`})},{default:Y(()=>[r.value<.75?(n(),o("div",ne,[e("span",ae,y(a.card.event.summary)+", ",1),e("span",se,y(c.value),1)])):w("",!0),e("div",re,[r.value>=.75?(n(),o("span",{key:0,class:M(["event-card__name",{"one-string":r.value<=1}])},y(a.card.event.summary),3)):w("",!0)]),r.value>=.75?(n(),o("span",le,y(_.value),1)):w("",!0)]),_:1},8,["grid","style","class"])):w("",!0)}}},oe=[{time:"01:00",percent:100/24},{time:"02:00",percent:200/24},{time:"03:00",percent:300/24},{time:"04:00",percent:400/24},{time:"05:00",percent:500/24},{time:"06:00",percent:600/24},{time:"07:00",percent:700/24},{time:"08:00",percent:800/24},{time:"09:00",percent:900/24},{time:"10:00",percent:1e3/24},{time:"11:00",percent:1100/24},{time:"12:00",percent:1200/24},{time:"13:00",percent:1300/24},{time:"14:00",percent:1400/24},{time:"15:00",percent:1500/24},{time:"16:00",percent:1600/24},{time:"17:00",percent:1700/24},{time:"18:00",percent:1800/24},{time:"19:00",percent:1900/24},{time:"20:00",percent:2e3/24},{time:"21:00",percent:2100/24},{time:"22:00",percent:2200/24},{time:"23:00",percent:2300/24}],ie={class:"planner-date__weekday"},de={class:"planner-date__day"},ue={__name:"PlannerDate",props:["day"],setup(a){return(s,r)=>(n(),o("div",{class:M(["planner-date",{current:a.day.isToday}])},[e("span",ie,y(a.day.weekday),1),e("div",de,[e("span",null,y(a.day.date),1)])],2))}},_e={class:"planner__grid-wrapper"},ve={class:"planner__days-header"},pe={class:"planner__line-time"},me={class:"planner__line-time"},he={__name:"PlannerGrid",props:["events","currentDate","selectedEvent"],emits:["cardClick"],setup(a,{emit:s}){const r=a,c=s,u=g=>{const p=g.sort((t,d)=>new Date(t.start)-new Date(d.start));for(let t=1;t<p.length;t++){const d=p[t],T=new Date(d.start);for(let b=t-1;b>=0;b--){const D=p[b];if(T>new Date(D.start)&&T<new Date(D.end)){D.overlapLevel?d.overlapLevel=D.overlapLevel+1:d.overlapLevel=1;break}}}return p},v=$(()=>{const g=P(r.currentDate),p=[];for(let t=0;t<7;t++){const d=new Date(g);d.setDate(g.getDate()+t),p.push({weekday:d.toLocaleDateString("en-EN",{weekday:"short"}),date:d.getDate(),isToday:Z(d,new Date),day:d,cards:[]})}return r.events.forEach(t=>{if(!t.start.dateTime)return;const d=new Date(t.start.dateTime),T=new Date(t.end.dateTime);if(d.getDate()===T.getDate()){const b=p.find(W=>W.date===d.getDate());if(!b)return;const D={event:t,start:t.start.dateTime,end:t.end.dateTime};b.cards.push(D)}else{const b={event:t,start:t.start.dateTime,end:t.start.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T23:59:00")},D=p.find(B=>B.date===d.getDate());D&&D.cards.push(b);const W={event:t,start:t.end.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T00:00:00"),end:t.end.dateTime},A=p.find(B=>B.date===T.getDate());D&&A.cards.push(W)}}),p.forEach(t=>t.cards=u(t.cards)),p}),_=m(null),h=m(),i=m(null),k=m(null),l=m({caption:"",styleTop:""}),f=()=>{k.value.style.display="none";const g=document.querySelector(".planner-date.current");if(!g)return;const p=(g.getBoundingClientRect().left-i.value.getBoundingClientRect().left)/i.value.offsetWidth*100,t=g.offsetWidth*.9/i.value.offsetWidth*100;k.value.style.left=`${p}%`,k.value.style.width=`${t}%`,k.value.style.display="block"},C=()=>{const g=new Date;l.value.caption=H(g),l.value.styleTop=`${F(g)*100/24}%`},X=async()=>{C(),await z(),f(),i.value.scrollIntoView({block:"center"});const p=(60-new Date().getSeconds())*1e3;setTimeout(()=>{C(),setInterval(C,6e4)},p)};return R(async()=>{await z(),X(),h.value=_.value.offsetHeight}),(g,p)=>(n(),o("div",_e,[e("div",ve,[(n(!0),o(E,null,S(v.value,t=>(n(),x(ue,{key:t.date,day:t},null,8,["day"]))),128))]),e("div",{class:"planner__grid",ref_key:"grid",ref:_},[(n(!0),o(E,null,S(v.value,t=>(n(),o("div",{class:"planner__day-column",key:t.date},[(n(!0),o(E,null,S(t.cards,(d,T)=>(n(),x(ce,{key:T,card:d,gridHeight:h.value,onClick:b=>c("cardClick",d.event),class:M({selected:a.selectedEvent===d.event})},null,8,["card","gridHeight","onClick","class"]))),128))]))),128)),(n(!0),o(E,null,S(I(oe),(t,d)=>(n(),o("div",{class:"planner__line",key:d,style:V({top:`${t.percent}%`})},[e("div",pe,y(t.time),1)],4))),128)),e("div",{class:"planner__line planner__line--now",style:V({top:`${l.value.styleTop}`}),ref_key:"timeLineEl",ref:i},[e("div",me,y(l.value.caption),1),e("div",{class:"planner__line-today-line",ref_key:"todayLine",ref:k},null,512)],4)],512)]))}},fe={class:"planner-header"},ye={class:"planner-header__date"},ge={class:"planner-header__buttons"},ke={__name:"PlannerHeader",props:O(["isSidebarOpened","currentMonth"],{modelValue:{},modelModifiers:{}}),emits:O(["prevWeek","nextWeek","updateEvents"],["update:modelValue"]),setup(a,{emit:s}){const r=s,c=J(a,"modelValue");return(u,v)=>(n(),o("header",fe,[e("span",ye,y(a.currentMonth),1),e("div",ge,[e("button",{class:"planner-header__date-button planner-header__date-button--prev icon-button",onClick:v[0]||(v[0]=_=>r("prevWeek"))}),e("button",{class:"planner-header__date-button planner-header__date-button--next icon-button",onClick:v[1]||(v[1]=_=>r("nextWeek"))})]),e("label",{class:M(["sidebar-hide icon-button",{rotated:!c.value}])},[K(e("input",{type:"checkbox",class:"visually-hidden","onUpdate:modelValue":v[2]||(v[2]=_=>c.value=_)},null,512),[[Q,c.value]])],2)]))}},$e={},we={class:"loading-container"},De=e("div",{class:"loading-progress"},null,-1),be=[De];function Ce(a,s){return n(),o("div",we,be)}const Te=U($e,[["render",Ce]]),Le={},xe={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Me=e("path",{d:"M20.7457 3.32854C20.3552 2.93801 19.722 2.93801 19.3315 3.32854L12.0371 10.6229L4.74275 3.32854C4.35223 2.93801 3.71906 2.93801 3.32854 3.32854C2.93801 3.71906 2.93801 4.35223 3.32854 4.74275L10.6229 12.0371L3.32856 19.3314C2.93803 19.722 2.93803 20.3551 3.32856 20.7457C3.71908 21.1362 4.35225 21.1362 4.74277 20.7457L12.0371 13.4513L19.3315 20.7457C19.722 21.1362 20.3552 21.1362 20.7457 20.7457C21.1362 20.3551 21.1362 19.722 20.7457 19.3315L13.4513 12.0371L20.7457 4.74275C21.1362 4.35223 21.1362 3.71906 20.7457 3.32854Z",fill:"currentColor"},null,-1),Ee=[Me];function Se(a,s){return n(),o("svg",xe,Ee)}const He=U(Le,[["render",Se]]),Ve={class:"event-info-sidebar"},We={class:"event-info-sidebar__buttons-wrapper"},Be={class:"event-info-sidebar__event-title"},Pe={class:"event-characteristics"},ze=e("span",{class:"event-characteristics__name"},"Duration",-1),Ie={class:"event-characteristics__value"},Ne=e("span",{class:"event-characteristics__name"},"Dates",-1),Re={class:"event-characteristics__value"},Oe={key:0},Fe=e("span",{class:"event-characteristics__name"},"Calendar",-1),Ue={class:"event-characteristics__value"},je={__name:"EventInfoSidebar",props:["event"],emits:["close"],setup(a,{emit:s}){const r=a,c=s,u=$(()=>{const _=new Date(r.event.start.dateTime),i=new Date(r.event.end.dateTime)-_,k=Math.floor(i/(1e3*60*60)),l=Math.floor(i%(1e3*60*60)/(1e3*60));return`${k} hr${k>1?"s":""}${l>0?` ${l} min`:""}`}),v=$(()=>{const _=new Date(r.event.start.dateTime),h=new Date(r.event.end.dateTime);return`${_.getDate()}/${_.getMonth()} ${H(_)} - ${H(h)}`});return(_,h)=>(n(),o("div",Ve,[e("div",We,[e("button",{class:"event-info-sidebar__button icon-button",onClick:h[0]||(h[0]=i=>c("close"))},[N(He)])]),e("span",Be,y(a.event.summary),1),e("ul",Pe,[e("li",null,[ze,e("span",Ie,y(u.value),1)]),e("li",null,[Ne,e("span",Re,y(v.value),1)]),a.event.calendar?(n(),o("li",Oe,[Fe,e("span",Ue,y(a.event.calendar),1)])):w("",!0)])]))}},qe={class:"task"},Xe=["for"],Ae=["id"],Ge={__name:"TaskItem",props:["task"],setup(a){return(s,r)=>(n(),o("div",qe,[e("span",{class:"task__color",style:V({backgroundColor:a.task.color})},null,4),e("label",{class:"task__checkbox-label",for:s.title},[e("input",{class:"visually-hidden",id:s.title,type:"checkbox"},null,8,Ae)],8,Xe),e("span",null,y(a.task.name),1)]))}},Ye={class:"right-sidebar"},Ze={class:"right-sidebar__tabs"},Je=e("span",null,"Tasks",-1),Ke=[Je],Qe={class:"underline"},et={key:0,class:"tasks"},tt={__name:"RightSidebar",setup(a){const s=m(),r=m();m(null);const c=m(null),u=m(null),v=m(j.value.tasks);return R(()=>{u.value=c.value}),q(u,()=>{s.value.style.transform=`translateX(${u.value.offsetLeft}px)`,r.value.style.transform=`translateX(${u.value.offsetLeft}px)`}),(_,h)=>(n(),o("div",Ye,[e("div",Ze,[e("button",{ref_key:"tasksButton",ref:c,class:"right-sidebar__tab",onClick:h[0]||(h[0]=i=>u.value=c.value)},Ke,512),e("div",Qe,[e("div",{ref_key:"underlineRight",ref:s,class:"underline__closer underline__closer--right"},null,512),e("div",{ref_key:"underlineLeft",ref:r,class:"underline__closer underline__closer--left"},null,512)])]),u.value===c.value?(n(),o("div",et,[(n(!0),o(E,null,S(v.value,i=>(n(),x(Ge,{key:i.id,task:i},null,8,["task"]))),128))])):w("",!0)]))}},nt={class:"planner-wrapper"},at={class:"planner"},st={key:0,class:"planner__loader-wrapper"},lt={__name:"Planner",setup(a){const s=m(!0),r=m(),c=m(!0),u=async(l=new Date)=>{try{const f=await ee.get(l);r.value=f,L.value=l}catch(f){console.error("ошибка",f)}finally{c.value=!1,await z()}},v=async()=>{if(c.value)return;c.value=!0;const l=L.value,f=P(new Date(l.setDate(l.getDate()+7)));u(f)},_=async()=>{if(c.value)return;c.value=!0;const l=L.value,f=P(new Date(l.setDate(l.getDate()-7)));u(f)};q(te,l=>{l&&u(L.value)});const h=$(()=>{if(L.value){const l=L.value;return`${l.toLocaleString("default",{month:"long"})} ${l.getFullYear()}`}else return""});R(()=>{u()});const i=m(null),k=l=>{i.value=l};return(l,f)=>(n(),o("div",nt,[e("div",at,[N(ke,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=C=>s.value=C),currentMonth:h.value,onPrevWeek:_,onNextWeek:v},null,8,["modelValue","currentMonth"]),c.value?(n(),o("div",st,[N(Te)])):w("",!0),c.value?w("",!0):(n(),x(he,{key:1,events:r.value,"current-date":I(L),selectedEvent:i.value,onCardClick:k},null,8,["events","current-date","selectedEvent"]))]),I(j)?(n(),o("div",{key:0,class:M(["planner__right-sidebar",{hidden:!s.value}])},[i.value?w("",!0):(n(),x(tt,{key:0})),i.value?(n(),x(je,{key:1,event:i.value,onClose:f[1]||(f[1]=C=>i.value=null)},null,8,["event"])):w("",!0)],2)):w("",!0)]))}};export{lt as default};
