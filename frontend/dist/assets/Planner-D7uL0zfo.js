import{e as D,f as m,g as E,h as N,r as U,o as n,i as T,w as j,c as i,b as e,t as h,j as $,n as L,k as H,l as P,m as B,F as x,p as M,u as R,q as I,s as q,v as X,x as A,_ as O,a as S,y as F,z as G,A as Y,B as Z,C as J}from"./index-DGkT8HfO.js";const K={key:0,class:"event-card__short-wrapper"},Q={class:"event-card__name"},ee={class:"event-card__time"},te={class:"event-card__name-wrapper"},ne={key:1,class:"event-card__time"},ae={__name:"EventCard",props:["card","gridHeight"],setup(a){const s=a,t=D(()=>(new Date(s.card.end)-new Date(s.card.start))/(1e3*60*60)),c=m(E(s.card.event.start.dateTime)),p=D(()=>N(s.card.start)*100/24),_=D(()=>Math.max(t.value,.25)*100/24),d=D(()=>`${c.value} - ${E(s.card.event.end.dateTime)}`),v=D(()=>new Date(s.card.event.end.dateTime)<new Date),y=D(()=>s.gridHeight?[10,s.gridHeight/96]:[0,0]),w=D(()=>s.card.overlapLevel?s.card.overlapLevel+1:1);return(f,k)=>{const o=U("vue-draggable-resizable");return a.gridHeight?(n(),T(o,{key:0,class:L(["event-card",{"no-padding":t.value<=.25,"no-right-padding":t.value<=.5,past:v.value,overlap:a.card.overlapLevel}]),axis:"y",grid:y.value,handles:["tm","bm"],active:!0,style:H({top:`${p.value}%`,height:`calc(${_.value}% - 2px)`,backgroundColor:`${a.card.event.background_color}`,color:`${a.card.event.foreground_color}`,width:`calc(100% - ${w.value*.75}rem)`})},{default:j(()=>[t.value<.75?(n(),i("div",K,[e("span",Q,h(a.card.event.summary)+", ",1),e("span",ee,h(c.value),1)])):$("",!0),e("div",te,[t.value>=.75?(n(),i("span",{key:0,class:L(["event-card__name",{"one-string":t.value<=1}])},h(a.card.event.summary),3)):$("",!0)]),t.value>=.75?(n(),i("span",ne,h(d.value),1)):$("",!0)]),_:1},8,["grid","style","class"])):$("",!0)}}},se=[{time:"01:00",percent:100/24},{time:"02:00",percent:200/24},{time:"03:00",percent:300/24},{time:"04:00",percent:400/24},{time:"05:00",percent:500/24},{time:"06:00",percent:600/24},{time:"07:00",percent:700/24},{time:"08:00",percent:800/24},{time:"09:00",percent:900/24},{time:"10:00",percent:1e3/24},{time:"11:00",percent:1100/24},{time:"12:00",percent:1200/24},{time:"13:00",percent:1300/24},{time:"14:00",percent:1400/24},{time:"15:00",percent:1500/24},{time:"16:00",percent:1600/24},{time:"17:00",percent:1700/24},{time:"18:00",percent:1800/24},{time:"19:00",percent:1900/24},{time:"20:00",percent:2e3/24},{time:"21:00",percent:2100/24},{time:"22:00",percent:2200/24},{time:"23:00",percent:2300/24}],re={class:"planner__line-time"},le={class:"planner__line-time"},oe={__name:"PlannerGrid",props:["days","selectedEvent"],emits:["eventClick"],setup(a,{emit:s}){const t=s,c=m(null),p=m(),_=m(null),d=m(null),v=m({caption:"",styleTop:""}),y=()=>{d.value.style.display="none";const k=document.querySelector(".planner-date.current");if(!k)return;const o=(k.getBoundingClientRect().left-_.value.getBoundingClientRect().left)/_.value.offsetWidth*100,r=k.offsetWidth*.9/_.value.offsetWidth*100;d.value.style.left=`${o}%`,d.value.style.width=`${r}%`,d.value.style.display="block"},w=()=>{const k=new Date;v.value.caption=E(k),v.value.styleTop=`${N(k)*100/24}%`},f=async()=>{w(),await B(),y(),_.value.scrollIntoView({block:"center"});const o=(60-new Date().getSeconds())*1e3;setTimeout(()=>{w(),setInterval(w,6e4)},o)};return P(async()=>{await B(),f(),p.value=c.value.offsetHeight}),(k,o)=>(n(),i("div",{class:"planner__grid",ref_key:"grid",ref:c},[(n(!0),i(x,null,M(a.days,r=>(n(),i("div",{class:"planner__day-column",key:r.date},[(n(!0),i(x,null,M(r.cards,(u,l)=>(n(),T(ae,{key:l,card:u,gridHeight:p.value,onClick:g=>t("cardClick",u),class:L({selected:a.selectedEvent===u.event})},null,8,["card","gridHeight","onClick","class"]))),128))]))),128)),(n(!0),i(x,null,M(R(se),(r,u)=>(n(),i("div",{class:"planner__line",key:u,style:H({top:`${r.percent}%`})},[e("div",re,h(r.time),1)],4))),128)),e("div",{class:"planner__line planner__line--now",style:H({top:`${v.value.styleTop}`}),ref_key:"timeLineEl",ref:_},[e("div",le,h(v.value.caption),1),e("div",{class:"planner__line-today-line",ref_key:"todayLine",ref:d},null,512)],4)],512))}},ce={class:"planner-header"},ie={class:"planner-header__date"},de={class:"planner-header__buttons"},ue={__name:"PlannerHeader",props:I(["isSidebarOpened","currentMonth"],{modelValue:{},modelModifiers:{}}),emits:I(["prevWeek","nextWeek"],["update:modelValue"]),setup(a,{emit:s}){const t=s,c=q(a,"modelValue");return(p,_)=>(n(),i("header",ce,[e("span",ie,h(a.currentMonth),1),e("div",de,[e("button",{class:"planner-header__date-button planner-header__date-button--prev icon-button",onClick:_[0]||(_[0]=d=>t("prevWeek"))}),e("button",{class:"planner-header__date-button planner-header__date-button--next icon-button",onClick:_[1]||(_[1]=d=>t("nextWeek"))})]),e("label",{class:L(["sidebar-hide icon-button",{rotated:!c.value}])},[X(e("input",{type:"checkbox",class:"visually-hidden","onUpdate:modelValue":_[2]||(_[2]=d=>c.value=d)},null,512),[[A,c.value]])],2)]))}},_e={},ve={class:"loading-container"},pe=e("div",{class:"loading-progress"},null,-1),me=[pe];function he(a,s){return n(),i("div",ve,me)}const ye=O(_e,[["render",he]]),fe={},ge={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ke=e("path",{d:"M20.7457 3.32854C20.3552 2.93801 19.722 2.93801 19.3315 3.32854L12.0371 10.6229L4.74275 3.32854C4.35223 2.93801 3.71906 2.93801 3.32854 3.32854C2.93801 3.71906 2.93801 4.35223 3.32854 4.74275L10.6229 12.0371L3.32856 19.3314C2.93803 19.722 2.93803 20.3551 3.32856 20.7457C3.71908 21.1362 4.35225 21.1362 4.74277 20.7457L12.0371 13.4513L19.3315 20.7457C19.722 21.1362 20.3552 21.1362 20.7457 20.7457C21.1362 20.3551 21.1362 19.722 20.7457 19.3315L13.4513 12.0371L20.7457 4.74275C21.1362 4.35223 21.1362 3.71906 20.7457 3.32854Z",fill:"currentColor"},null,-1),$e=[ke];function we(a,s){return n(),i("svg",ge,$e)}const De=O(fe,[["render",we]]),be={class:"event-info-sidebar"},Ce={class:"event-info-sidebar__buttons-wrapper"},Te={class:"event-info-sidebar__event-title"},Le={class:"event-characteristics"},xe=e("span",{class:"event-characteristics__name"},"Duration",-1),Me={class:"event-characteristics__value"},Ee=e("span",{class:"event-characteristics__name"},"Dates",-1),Se={class:"event-characteristics__value"},He={key:0},Ve=e("span",{class:"event-characteristics__name"},"Calendar",-1),We={class:"event-characteristics__value"},Be={__name:"EventInfoSidebar",props:["event"],emits:["close"],setup(a,{emit:s}){const t=a,c=s,p=D(()=>{const d=new Date(t.event.start.dateTime),y=new Date(t.event.end.dateTime)-d,w=Math.floor(y/(1e3*60*60)),f=Math.floor(y%(1e3*60*60)/(1e3*60));return`${w} hr${w>1?"s":""}${f>0?` ${f} min`:""}`}),_=D(()=>{const d=new Date(t.event.start.dateTime),v=new Date(t.event.end.dateTime);return`${d.getDate()}/${d.getMonth()} ${E(d)} - ${E(v)}`});return(d,v)=>(n(),i("div",be,[e("div",Ce,[e("button",{class:"event-info-sidebar__button icon-button",onClick:v[0]||(v[0]=y=>c("close"))},[S(De)])]),e("span",Te,h(a.event.summary),1),e("ul",Le,[e("li",null,[xe,e("span",Me,h(p.value),1)]),e("li",null,[Ee,e("span",Se,h(_.value),1)]),a.event.calendar?(n(),i("li",He,[Ve,e("span",We,h(a.event.calendar),1)])):$("",!0)])]))}},Pe={class:"planner-date__weekday"},ze={class:"planner-date__day"},Ie={__name:"PlannerDate",props:["day"],setup(a){return(s,t)=>(n(),i("div",{class:L(["planner-date",{current:a.day.isToday}])},[e("span",Pe,h(a.day.weekday),1),e("div",ze,[e("span",null,h(a.day.date),1)])],2))}},Ne={class:"task"},Re=["for"],Oe=["id"],Fe={__name:"TaskItem",props:["task"],setup(a){return(s,t)=>(n(),i("div",Ne,[e("span",{class:"task__color",style:H({backgroundColor:a.task.color})},null,4),e("label",{class:"task__checkbox-label",for:s.title},[e("input",{class:"visually-hidden",id:s.title,type:"checkbox"},null,8,Oe)],8,Re),e("span",null,h(a.task.name),1)]))}},Ue={class:"right-sidebar"},je={class:"right-sidebar__tabs"},qe=e("span",null,"Tasks",-1),Xe=[qe],Ae={class:"underline"},Ge={key:0,class:"tasks"},Ye={__name:"RightSidebar",setup(a){const s=m(),t=m();m(null);const c=m(null),p=m(null),_=m(F.value.tasks);return P(()=>{p.value=c.value}),G(p,()=>{s.value.style.transform=`translateX(${p.value.offsetLeft}px)`,t.value.style.transform=`translateX(${p.value.offsetLeft}px)`}),(d,v)=>(n(),i("div",Ue,[e("div",je,[e("button",{ref_key:"tasksButton",ref:c,class:"right-sidebar__tab",onClick:v[0]||(v[0]=y=>p.value=c.value)},Xe,512),e("div",Ae,[e("div",{ref_key:"underlineRight",ref:s,class:"underline__closer underline__closer--right"},null,512),e("div",{ref_key:"underlineLeft",ref:t,class:"underline__closer underline__closer--left"},null,512)])]),p.value===c.value?(n(),i("div",Ge,[(n(!0),i(x,null,M(_.value,y=>(n(),T(Fe,{key:y.id,task:y},null,8,["task"]))),128))])):$("",!0)]))}},Ze={class:"planner-wrapper"},Je={class:"planner"},Ke={key:0,class:"planner__loader-wrapper"},Qe={key:1,class:"planner__grid-wrapper"},et={class:"planner__days-header"},at={__name:"Planner",setup(a){const s=m(!0),t=m([]),c=m(!0),p=o=>{const r=o.sort((u,l)=>new Date(u.start)-new Date(l.start));for(let u=1;u<r.length;u++){const l=r[u],g=new Date(l.start);for(let C=u-1;C>=0;C--){const b=r[C];if(g>new Date(b.start)&&g<new Date(b.end)){b.overlapLevel?l.overlapLevel=b.overlapLevel+1:l.overlapLevel=1;break}}}return r},_=(o,r)=>{const u=Z(o);t.value=[];for(let l=0;l<7;l++){const g=new Date(u);g.setDate(u.getDate()+l),t.value.push({weekday:g.toLocaleDateString("en-EN",{weekday:"short"}),date:g.getDate(),isToday:J(g,new Date),day:g,cards:[]})}r.forEach(l=>{const g=new Date(l.start.dateTime),C=new Date(l.end.dateTime);if(g.getDate()===C.getDate()){const b=t.value.find(V=>V.date===g.getDate()),z={event:l,start:l.start.dateTime,end:l.end.dateTime};b.cards.push(z)}else{const b={event:l,start:l.start.dateTime,end:l.start.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T23:59:00")};t.value.find(W=>W.date===g.getDate()).cards.push(b);const V={event:l,start:l.end.dateTime.replace(/T\d{2}:\d{2}:\d{2}/,"T00:00:00"),end:l.end.dateTime};t.value.find(W=>W.date===C.getDate()).cards.push(V)}}),t.value.forEach(l=>l.cards=p(l.cards))},d=async(o=new Date)=>{try{const r=await Y.get(o);_(o,r)}catch(r){console.error("ошибка",r)}finally{c.value=!1,await B()}},v=async()=>{if(c.value)return;c.value=!0;const o=t.value[0].day,r=new Date(o.setDate(o.getDate()+7));d(r)},y=async()=>{if(c.value)return;c.value=!0;const o=t.value[0].day,r=new Date(o.setDate(o.getDate()-7));d(r)},w=D(()=>{if(t.value.length){const o=t.value[0].day;return`${o.toLocaleString("default",{month:"long"})} ${o.getFullYear()}`}else return""});P(()=>{d()});const f=m(null),k=o=>{f.value=o};return(o,r)=>(n(),i("div",Ze,[e("div",Je,[S(ue,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=u=>s.value=u),currentMonth:w.value,onPrevWeek:y,onNextWeek:v},null,8,["modelValue","currentMonth"]),c.value?(n(),i("div",Ke,[S(ye)])):$("",!0),c.value?$("",!0):(n(),i("div",Qe,[e("div",et,[(n(!0),i(x,null,M(t.value,u=>(n(),T(Ie,{key:u.date,day:u},null,8,["day"]))),128))]),S(oe,{days:t.value,selectedEvent:f.value,onEventClick:k},null,8,["days","selectedEvent"])]))]),R(F)?(n(),i("div",{key:0,class:L(["planner__right-sidebar",{hidden:!s.value}])},[f.value?$("",!0):(n(),T(Ye,{key:0})),f.value?(n(),T(Be,{key:1,event:f.value,onClose:r[1]||(r[1]=u=>f.value=null)},null,8,["event"])):$("",!0)],2)):$("",!0)]))}};export{at as default};
